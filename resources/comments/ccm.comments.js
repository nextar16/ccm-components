ccm.component({name:"comments",config:{html:[ccm.store,{local:"http://mklemp2s.github.io/ccm-components/resources/comments/template.json"}],key:"mk_comment",store:[ccm.store,{url:"ws://ccm2.inf.h-brs.de/index.js",store:"mk_comments_1_0_0"}],style:[ccm.load,"http://mklemp2s.github.io/ccm-components/resources/comments/comments.css"],user:[ccm.instance,"https://kaul.inf.h-brs.de/ccm/components/user2.js"],likes:[ccm.component,"https://nextar16.github.io/ccm-components/resources/likes/ccm.likes.js"]},Instance:function(){var e=this;e.init=function(t){e.store.onChange=function(){e.render()},t()},e.render=function(t){var c=ccm.helper.element(e);e.store.get(e.key,function(n){function m(){return Math.floor(2147483647*Math.random()+1)}function o(n){c.html(ccm.helper.html(e.html.get("main")));for(var o=ccm.helper.find(e,".comments"),r=0;r<n.comments.length;r++){var s=n.comments[r];o.append(ccm.helper.html(e.html.get("comment"),{id:ccm.helper.val(s.id),name:ccm.helper.val(s.user),date:ccm.helper.val(s.date),text:ccm.helper.val(s.text)})),e.likes.render({element:jQuery("#"+s.id),parent:e})}o.append(ccm.helper.html(e.html.get("input"),{onsubmit:function(){var t=ccm.helper.val(ccm.helper.find(e,"input").val()).trim(),c=new Date;if(""!==t)return e.user.login(function(){n.comments.push({id:m(),user:e.user.data().key,text:t,date:c.getDate()+"."+(c.getMonth()+1)+"."+c.getFullYear()}),e.store.set(n,function(){e.render()})}),!1}})),t&&t()}null===n?e.store.set({key:e.key,comments:[]},o):o(n)})}}});